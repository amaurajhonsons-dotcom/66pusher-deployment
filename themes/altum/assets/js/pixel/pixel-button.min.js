class AltumCode66pusherButton{constructor(t){this.options={},this.options.content=t.content||"",this.options.button=t.button||"",this.options.subscribed_success_url=void 0===t.subscribed_success_url?null:t.subscribed_success_url,this.options.trigger_all_pages=void 0===t.trigger_all_pages||t.trigger_all_pages,this.options.triggers=t.triggers||[],this.options.display_mobile=void 0===t.display_mobile||t.display_mobile,this.options.display_desktop=void 0===t.display_desktop||t.display_desktop,this.options.on_animation=void 0===t.on_animation?"fadeIn":t.on_animation,this.options.off_animation=void 0===t.off_animation?"fadeOut":t.off_animation}async build(){if(!this.options.trigger_all_pages&&!this.is_page_triggered(this.options.triggers)||!this.options.display_mobile&&window.innerWidth<768||!this.options.display_desktop&&window.innerWidth>768)return!1;let t=document.createElement("div");t.className="altumcode-66pusher-button",t.innerHTML=this.options.content;let e=t.querySelector("[data-wrapper]"),i=()=>{t.querySelector("[data-title]").innerHTML=this.options.button.subscribed_title,t.querySelector("[data-description]").innerHTML=this.options.button.subscribed_description,this.options.button.subscribed_image_url&&(t.querySelector("[data-image]").src=this.options.button.subscribed_image_url,t.querySelector("[data-image]").alt=this.options.button.subscribed_image_alt),setTimeout(()=>{this.options.subscribed_success_url&&(window.location.href=this.options.subscribed_success_url),o()},4e3)},s=()=>{t.querySelector("[data-title]").innerHTML=this.options.button.unsubscribed_title,t.querySelector("[data-description]").innerHTML=this.options.button.unsubscribed_description,this.options.button.unsubscribed_image_url&&(t.querySelector("[data-image]").src=this.options.button.unsubscribed_image_url,t.querySelector("[data-image]").alt=this.options.button.unsubscribed_image_alt),setTimeout(()=>{this.options.unsubscribed_success_url&&(window.location.href=this.options.unsubscribed_success_url),n()},4e3)},o=()=>{t.querySelector("[data-title]").innerHTML=this.options.button.unsubscribe_title,t.querySelector("[data-description]").innerHTML=this.options.button.unsubscribe_description,this.options.button.unsubscribe_image_url&&(t.querySelector("[data-image]").src=this.options.button.unsubscribe_image_url,t.querySelector("[data-image]").alt=this.options.button.unsubscribe_image_alt)},n=()=>{t.querySelector("[data-title]").innerHTML=this.options.button.title,t.querySelector("[data-description]").innerHTML=this.options.button.description,this.options.button.image_url&&(t.querySelector("[data-image]").src=this.options.button.image_url,t.querySelector("[data-image]").alt=this.options.button.image_alt)},a=()=>{e.addEventListener("click",()=>{location.reload()}),t.querySelector("[data-title]").innerHTML=this.options.button.permission_denied_title,t.querySelector("[data-description]").innerHTML=this.options.button.permission_denied_description,this.options.button.permission_denied_image_url&&(t.querySelector("[data-image]").src=this.options.button.permission_denied_image_url,t.querySelector("[data-image]").alt=this.options.button.permission_denied_image_alt)};return await get_notification_permission()=="denied"?a():(await get_subscription_status()?o():n(),e.addEventListener("click",async e=>{(t.querySelector("[data-loading]").style.display="flex",await get_subscription_status())?await unsubscribe()&&s():await request_push_notification_permission_and_subscribe(e)?i():a(),t.querySelector("[data-loading]").style.display="none"})),t}initiate(){let t=()=>{let t=setInterval(()=>{pixel_button_css_loaded&&(clearInterval(t),this.process())},100)};"complete"!==document.readyState&&("loading"===document.readyState||document.documentElement.doScroll)?document.addEventListener("DOMContentLoaded",()=>{t()}):t();let e=window.location.href;(t=>{let e=t.pushState;t.pushState=function(i){let s=e.apply(t,arguments);return window.dispatchEvent(new Event("66pusher_url_change")),s}})(window.history);let i=()=>{e!==window.location.href&&(e=window.location.href,t())};window.addEventListener("popstate",i),window.addEventListener("66pusher_url_change",i)}async process(){let t=await this.build();if(!t)return!1;document.querySelector(`[data-${pixel_exposed_identifier}-button]`)&&(document.querySelector(`[data-${pixel_exposed_identifier}-button]`).classList.add("altumcode-66pusher-button-inline-block"),document.querySelector(`[data-${pixel_exposed_identifier}-button]`).appendChild(t))}is_page_triggered(t){let e=!1;for(let i of t)if(i.type.startsWith("not_")){e=!0;break}return t.forEach(t=>{switch(t.type){case"exact":t.value==window.location.href&&(e=!0);break;case"not_exact":t.value==window.location.href&&(e=!1);break;case"contains":window.location.href.includes(t.value)&&(e=!0);break;case"not_contains":window.location.href.includes(t.value)&&(e=!1);break;case"starts_with":window.location.href.startsWith(t.value)&&(e=!0);break;case"not_starts_with":window.location.href.startsWith(t.value)&&(e=!1);break;case"ends_with":window.location.href.endsWith(t.value)&&(e=!0);break;case"not_ends_with":window.location.href.endsWith(t.value)&&(e=!1);break;case"page_contains":document.body.innerText.includes(t.value)&&(e=!0)}}),e}}
