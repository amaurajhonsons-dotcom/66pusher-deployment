let get_scroll_percentage=()=>{let t=document.documentElement,e=document.body,i="scrollTop",s="scrollHeight";return(t[i]||e[i])/((t[s]||e[s])-t.clientHeight)*100};class AltumCode66pusherWidget{constructor(t){this.options={},this.options.content=t.content||"",this.options.widget=t.widget||"",this.options.delay=void 0===t.delay?3e3:t.delay,this.options.duration=void 0===t.duration?-1:t.duration,this.options.stop_on_focus=!0,this.options.position=void 0===t.position?"top_center":t.position,this.options.subscribed_success_url=void 0===t.subscribed_success_url?null:t.subscribed_success_url,this.options.trigger_all_pages=void 0===t.trigger_all_pages||t.trigger_all_pages,this.options.triggers=t.triggers||[],this.options.display_frequency=void 0===t.display_frequency?"all_time":t.display_frequency,this.options.display_mobile=void 0===t.display_mobile||t.display_mobile,this.options.display_desktop=void 0===t.display_desktop||t.display_desktop,this.options.display_trigger=void 0===t.display_trigger?"delay":t.display_trigger,this.options.display_trigger_value=void 0===t.display_trigger_value?3:t.display_trigger_value,this.options.display_delay_type_after_close=void 0===t.display_delay_type_after_close?"time_on_site":t.display_delay_type_after_close,this.options.display_delay_value_after_close=void 0===t.display_delay_value_after_close?21600:t.display_delay_value_after_close,this.options.on_animation=void 0===t.on_animation?"fadeIn":t.on_animation,this.options.off_animation=void 0===t.off_animation?"fadeOut":t.off_animation,this.options.animation=void 0!==t.animation&&t.animation,this.options.animation_interval=void 0===t.animation_interval?5:t.animation_interval}async build(){if(await get_subscription_status()||!this.options.trigger_all_pages&&!this.is_page_triggered(this.options.triggers))return!1;switch(this.options.display_frequency){case"all_time":break;case"once_per_session":if(sessionStorage.getItem(`${pixel_exposed_identifier}_widget_display_frequency`))return!1;break;case"once_per_browser":if(localStorage.getItem(`${pixel_exposed_identifier}_widget_display_frequency`))return!1}if(!this.options.display_mobile&&window.innerWidth<768||!this.options.display_desktop&&window.innerWidth>768)return!1;if(sessionStorage.getItem(`${pixel_exposed_identifier}_widget_manually_closed`))switch(this.options.display_delay_type_after_close){case"time_on_site":if(parseInt(sessionStorage.getItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_time_on_site`)??0)<1e3*this.options.display_delay_value_after_close)return setInterval(()=>{let t=parseInt(sessionStorage.getItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_time_on_site`)??0);sessionStorage.setItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_time_on_site`,t+500)},500),!1;break;case"pageviews":let t=parseInt(sessionStorage.getItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_pageviews`)??0)+1;if(sessionStorage.setItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_pageviews`,t),t<this.options.display_delay_value_after_close)return!1}let e=document.createElement("div");e.className="altumcode-66pusher-widget",e.className+=` altumcode-66pusher-widget-${this.options.position}`,e.setAttribute("data-position",this.options.position),e.setAttribute("data-on-animation",this.options.on_animation),e.setAttribute("data-off-animation",this.options.off_animation),e.innerHTML=this.options.content;let i=e.querySelector("[data-close]");i&&i.addEventListener("click",t=>{t.stopPropagation(),sessionStorage.setItem(`${pixel_exposed_identifier}_widget_manually_closed`,!0),sessionStorage.removeItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_time_on_site`),sessionStorage.removeItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_pageviews`),this.constructor.remove_notification(e)});let s=e.querySelector("[data-subscribe]");return s&&(await get_notification_permission()=="denied"?s.addEventListener("click",()=>{location.reload()}):s.addEventListener("click",async t=>{e.querySelector("[data-loading]").style.display="flex";let i=await request_push_notification_permission_and_subscribe(t);e.querySelector("[data-loading]").style.display="none",i?(e.querySelector("[data-title]").innerHTML=this.options.widget.subscribed_title,e.querySelector("[data-description]").innerHTML=this.options.widget.subscribed_description,this.options.widget.subscribed_image_url&&(e.querySelector("[data-image]").src=this.options.widget.subscribed_image_url,e.querySelector("[data-image]").alt=this.options.widget.subscribed_image_alt),e.querySelector("[data-buttons]").style.cssText="display: none !important;"):(sessionStorage.setItem(`${pixel_exposed_identifier}_widget_manually_closed`,!0),sessionStorage.removeItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_time_on_site`),sessionStorage.removeItem(`${pixel_exposed_identifier}_widget_display_delay_type_after_close_pageviews`)),setTimeout(()=>{this.constructor.remove_notification(e),i&&this.options.subscribed_success_url&&(window.location.href=this.options.subscribed_success_url)},4e3)})),e}initiate(t={}){let e=()=>{let e=setInterval(()=>{pixel_widget_css_loaded&&(clearInterval(e),this.process(t))},100)};"complete"!==document.readyState&&("loading"===document.readyState||document.documentElement.doScroll)?document.addEventListener("DOMContentLoaded",()=>{e()}):e();let i=window.location.href;(t=>{let e=t.pushState;t.pushState=function(i){let s=e.apply(t,arguments);return window.dispatchEvent(new Event("66pusher_url_change")),s}})(window.history);let s=()=>{if(i!==window.location.href){i=window.location.href;let t=document.querySelector('div[class*="altumcode-66pusher-widget"][class*="on-"]');this.constructor.remove_notification(t),e()}};window.addEventListener("popstate",s),window.addEventListener("66pusher_url_change",s)}async process(t={}){let e=await this.build();if(!e)return!1;switch(this.options.position){case"top":case"top_floating":document.body.prepend(e);break;default:document.body.appendChild(e)}let i=async()=>{switch(await get_notification_permission()=="denied"&&(e.querySelector("[data-title]").innerHTML=this.options.widget.permission_denied_title,e.querySelector("[data-description]").innerHTML=this.options.widget.permission_denied_description,this.options.widget.permission_denied_image_url&&(e.querySelector("[data-image]").src=this.options.widget.permission_denied_image_url,e.querySelector("[data-image]").alt=this.options.widget.permission_denied_image_alt),e.querySelector("[data-subscribe]").innerHTML=this.options.widget.permission_denied_refresh_button,e.querySelector("[data-close]").innerHTML=this.options.widget.permission_denied_close_button),e.style.display="block",e.classList.add(`on-${this.options.on_animation}`),e.classList.add("on-visible"),setTimeout(()=>{e.classList.remove(`on-${this.options.on_animation}`)},1500),this.constructor.reposition(),this.options.animation&&(e.animation_interval=window.setInterval(()=>{e.classList.add(`animation-${this.options.animation}`),setTimeout(()=>{e.classList.remove(`animation-${this.options.animation}`)},(this.options.animation_interval-1)*1e3)},1e3*this.options.animation_interval)),-1!==this.options.duration&&(e.timeout=window.setTimeout(()=>{this.constructor.remove_notification(e)},this.options.duration)),this.options.stop_on_focus&&-1!==this.options.duration&&(e.addEventListener("mouseover",t=>{window.clearTimeout(e.timeout)}),e.addEventListener("mouseleave",()=>{e.timeout=window.setTimeout(()=>{this.constructor.remove_notification(e)},this.options.duration)})),this.options.display_frequency){case"all_time":break;case"once_per_session":sessionStorage.setItem(`${pixel_exposed_identifier}_widget_display_frequency`,!0);break;case"once_per_browser":localStorage.setItem(`${pixel_exposed_identifier}_widget_display_frequency`,!0)}window.removeEventListener("resize",this.constructor.reposition),window.addEventListener("resize",this.constructor.reposition)};switch(this.options.display_trigger){case"delay":setTimeout(()=>{i()},1e3*this.options.display_trigger_value);break;case"exit_intent":let s=!1;document.addEventListener("mouseout",t=>{let e=Math.max(document.documentElement.clientWidth,window.innerWidth||0);if(!(t.clientX>=e-50)&&!(t.clientY>=50))t.relatedTarget||t.toElement||s||(i(),s=!0)});break;case"scroll":let o=!1;document.addEventListener("scroll",t=>{!o&&get_scroll_percentage()>this.options.display_trigger_value&&(i(),o=!0)},{passive:!0});break;case"click":document.querySelector(this.options.display_trigger_value)&&document.querySelector(this.options.display_trigger_value).addEventListener("click",t=>{i()});break;case"hover":document.querySelector(this.options.display_trigger_value)&&document.querySelector(this.options.display_trigger_value).addEventListener("mouseenter",t=>{i()})}}is_page_triggered(t){let e=!1;for(let i of t)if(i.type.startsWith("not_")){e=!0;break}return t.forEach(t=>{switch(t.type){case"exact":t.value==window.location.href&&(e=!0);break;case"not_exact":t.value==window.location.href&&(e=!1);break;case"contains":window.location.href.includes(t.value)&&(e=!0);break;case"not_contains":window.location.href.includes(t.value)&&(e=!1);break;case"starts_with":window.location.href.startsWith(t.value)&&(e=!0);break;case"not_starts_with":window.location.href.startsWith(t.value)&&(e=!1);break;case"ends_with":window.location.href.endsWith(t.value)&&(e=!0);break;case"not_ends_with":window.location.href.endsWith(t.value)&&(e=!1);break;case"page_contains":document.body.innerText.includes(t.value)&&(e=!0)}}),e}static remove_notification(t){try{t.getAttribute("data-on-animation");let e=t.getAttribute("data-off-animation");t.classList.add(`off-${e}`),window.setTimeout(()=>{t.parentNode.removeChild(t)},400)}catch(i){}}static reposition(){let t=document.querySelector('div[class*="altumcode-66pusher-widget"][class*="on-"]'),e=Math.floor((window.innerHeight>0?window.innerHeight:screen.height)/2),i={top_left:{left:20,top:20},top_center:{top:20},top_right:{right:20,top:20},middle_left:{left:20,top:e},middle_center:{top:e},middle_right:{right:20,top:e},bottom_left:{left:20,bottom:20},bottom_center:{bottom:20},bottom_right:{right:20,bottom:20}},s=t.getAttribute("data-position"),o=t.offsetHeight;switch(s){default:break;case"top_left":case"top_center":case"top_right":t.style.top=`${i[s].top}px`,i[s].top+=o+20;break;case"middle_left":case"middle_center":case"middle_right":t.style.top=`${i[s].top-o/2}px`,i[s].top+=o+20;break;case"bottom_left":case"bottom_center":case"bottom_right":t.style.bottom=`${i[s].bottom}px`,i[s].bottom+=o+20}}}
